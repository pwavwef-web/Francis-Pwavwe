<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Episodes — The AZ Podcast Admin</title>
  <link rel="icon" href="../../favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    *{box-sizing:border-box}
    body{background:#0a0a0f;color:#f8fafc;font-family:'Inter',sans-serif;min-height:100vh}
    .fp-poppins{font-family:'Poppins',sans-serif}
    .fp-gold{color:#fbbf24}
    .fp-muted{color:#94a3b8}
    .sidebar{width:240px;flex-shrink:0;background:#0d1117;border-right:1px solid rgba(255,255,255,.07);min-height:100vh;padding:1.5rem 0;position:fixed;top:0;left:0;z-index:40}
    .sidebar-link{display:flex;align-items:center;gap:0.75rem;padding:0.6rem 1.25rem;color:#94a3b8;font-size:0.875rem;text-decoration:none;transition:all .2s;border-left:3px solid transparent}
    .sidebar-link:hover{color:#f8fafc;background:rgba(255,255,255,.05)}
    .sidebar-link.active{color:#fbbf24;background:rgba(251,191,36,.07);border-left-color:#fbbf24}
    .main{margin-left:240px;min-height:100vh;padding:2rem}
    .card{background:#111827;border:1px solid rgba(255,255,255,.08);border-radius:1rem}
    .badge{display:inline-flex;align-items:center;padding:0.2rem 0.6rem;border-radius:9999px;font-size:0.72rem;font-weight:600}
    .btn{display:inline-flex;align-items:center;gap:0.4rem;padding:0.45rem 0.9rem;border-radius:0.5rem;font-weight:600;font-family:'Inter',sans-serif;cursor:pointer;transition:all .2s;border:none;font-size:0.8rem;text-decoration:none}
    .btn-primary{background:#1e40af;color:#fff}
    .btn-primary:hover{background:#2563eb}
    .btn-danger{background:rgba(239,68,68,.15);color:#f87171;border:1px solid rgba(239,68,68,.2)}
    .btn-danger:hover{background:rgba(239,68,68,.25)}
    .btn-ghost{background:transparent;color:#94a3b8;border:1px solid rgba(255,255,255,.1)}
    .btn-ghost:hover{color:#f8fafc;border-color:rgba(255,255,255,.25)}
    input[type="search"]{background:#1e293b;border:1px solid rgba(255,255,255,.12);border-radius:0.5rem;color:#f8fafc;padding:0.55rem 1rem;font-family:'Inter',sans-serif;font-size:0.875rem;outline:none;transition:border-color .2s}
    input[type="search"]:focus{border-color:#6366f1}
    input[type="search"]::placeholder{color:#475569}
    @media(max-width:768px){.sidebar{display:none}.main{margin-left:0}}
  </style>
</head>
<body>
<script src="admin-auth.js"></script>
<script>requireAdmin();</script>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="px-5 mb-6">
    <p class="text-xs tracking-[0.2em] fp-gold font-semibold fp-poppins mb-0.5">THE AZ PODCAST</p>
    <p class="text-white font-bold fp-poppins text-sm">Admin Panel</p>
  </div>
  <nav>
    <a href="index.html" class="sidebar-link"><i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard</a>
    <a href="upload.html" class="sidebar-link"><i data-lucide="upload-cloud" class="w-4 h-4"></i> Upload Episode</a>
    <a href="manage.html" class="sidebar-link active"><i data-lucide="list" class="w-4 h-4"></i> Manage Episodes</a>
    <a href="analytics.html" class="sidebar-link"><i data-lucide="bar-chart-2" class="w-4 h-4"></i> Analytics</a>
    <a href="settings.html" class="sidebar-link"><i data-lucide="settings" class="w-4 h-4"></i> Settings</a>
    <div style="height:1px;background:rgba(255,255,255,.07);margin:1rem 1.25rem"></div>
    <a href="../index.html" class="sidebar-link"><i data-lucide="radio" class="w-4 h-4"></i> View Podcast</a>
    <a href="javascript:void(0)" onclick="adminLogout()" class="sidebar-link" style="color:#f87171"><i data-lucide="log-out" class="w-4 h-4"></i> Logout</a>
  </nav>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="flex items-start justify-between mb-8">
    <div>
      <p class="text-xs tracking-[0.2em] fp-muted fp-poppins mb-1">ADMIN TOOLS</p>
      <h1 class="fp-poppins text-2xl font-bold text-white">Manage Episodes</h1>
      <p class="fp-muted text-sm mt-1">Edit, publish, unpublish or delete episodes.</p>
    </div>
    <a href="upload.html" class="btn btn-primary"><i data-lucide="plus" class="w-4 h-4"></i> New Episode</a>
  </div>

  <!-- FILTERS -->
  <div class="flex flex-wrap gap-3 mb-6">
    <input type="search" id="searchInput" placeholder="Search episodes…" style="width:220px" oninput="filterEpisodes()">
    <select id="filterSeason" onchange="filterEpisodes()" style="background:#1e293b;border:1px solid rgba(255,255,255,.12);border-radius:0.5rem;color:#f8fafc;padding:0.55rem 1rem;font-family:'Inter',sans-serif;font-size:0.875rem;outline:none;cursor:pointer">
      <option value="all">All Seasons</option>
      <option value="1">Season 1</option>
    </select>
    <select id="filterStatus" onchange="filterEpisodes()" style="background:#1e293b;border:1px solid rgba(255,255,255,.12);border-radius:0.5rem;color:#f8fafc;padding:0.55rem 1rem;font-family:'Inter',sans-serif;font-size:0.875rem;outline:none;cursor:pointer">
      <option value="all">All Statuses</option>
      <option value="mock">Mock / Test</option>
      <option value="published">Published</option>
    </select>
  </div>

  <!-- EPISODES TABLE -->
  <div class="card overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead style="background:rgba(255,255,255,.03)">
          <tr style="border-bottom:1px solid rgba(255,255,255,.07)">
            <th class="text-left px-5 py-3 text-xs fp-muted font-medium tracking-wide w-16">#</th>
            <th class="text-left px-4 py-3 text-xs fp-muted font-medium tracking-wide">Episode</th>
            <th class="text-left px-4 py-3 text-xs fp-muted font-medium tracking-wide hidden sm:table-cell">Tags</th>
            <th class="text-left px-4 py-3 text-xs fp-muted font-medium tracking-wide hidden md:table-cell">Date</th>
            <th class="text-left px-4 py-3 text-xs fp-muted font-medium tracking-wide hidden lg:table-cell">Duration</th>
            <th class="text-left px-4 py-3 text-xs fp-muted font-medium tracking-wide">Status</th>
            <th class="text-right px-5 py-3 text-xs fp-muted font-medium tracking-wide">Actions</th>
          </tr>
        </thead>
        <tbody id="episodesTbody"></tbody>
      </table>
    </div>
    <div id="noResults" class="hidden text-center py-12 fp-muted text-sm">No episodes match your filters.</div>
  </div>

  <!-- DELETE MODAL -->
  <div id="deleteModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70">
    <div class="card p-6 max-w-sm w-full mx-4">
      <h3 class="fp-poppins font-bold text-white mb-2">Delete Episode?</h3>
      <p class="fp-muted text-sm mb-5" id="deleteModalText">This action cannot be undone.</p>
      <div class="flex gap-3">
        <button onclick="confirmDelete()" class="btn btn-danger flex-1 justify-center">Delete</button>
        <button onclick="closeDeleteModal()" class="btn btn-ghost flex-1 justify-center">Cancel</button>
      </div>
    </div>
  </div>
</main>

<script src="../az-episodes.js"></script>
<script>
  lucide.createIcons();

  let episodes = [...AZ_EPISODES];
  let toDeleteId = null;

  function filterEpisodes() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const season = document.getElementById('filterSeason').value;
    const status = document.getElementById('filterStatus').value;

    const filtered = episodes.filter(ep => {
      const matchQ = !q || ep.title.toLowerCase().includes(q) || (ep.guest||'').toLowerCase().includes(q);
      const matchSeason = season === 'all' || ep.season == season;
      const matchStatus = status === 'all' || (status === 'mock' && ep.isMock) || (status === 'published' && !ep.isMock);
      return matchQ && matchSeason && matchStatus;
    });
    renderTable(filtered);
  }

  function renderTable(list) {
    const tbody = document.getElementById('episodesTbody');
    const noRes = document.getElementById('noResults');
    if (!list.length) {
      tbody.innerHTML = '';
      noRes.classList.remove('hidden');
      return;
    }
    noRes.classList.add('hidden');
    tbody.innerHTML = list.map(ep => `
      <tr style="border-bottom:1px solid rgba(255,255,255,.04)" data-id="${ep.id}">
        <td class="px-5 py-4 fp-muted text-xs font-medium">S${ep.season}E${ep.episode}</td>
        <td class="px-4 py-4">
          <p class="text-white font-medium text-sm leading-tight">${ep.title}</p>
          ${ep.guest ? `<p class="text-xs fp-muted mt-0.5">w/ ${ep.guest}</p>` : ''}
        </td>
        <td class="px-4 py-4 hidden sm:table-cell">
          <div class="flex flex-wrap gap-1">
            ${ep.tags.map(t=>`<span class="badge" style="background:rgba(99,102,241,.12);color:#a5b4fc;border:1px solid rgba(99,102,241,.2)">${t}</span>`).join('')}
          </div>
        </td>
        <td class="px-4 py-4 fp-muted text-xs hidden md:table-cell">${ep.date}</td>
        <td class="px-4 py-4 fp-muted text-xs hidden lg:table-cell">${ep.duration}</td>
        <td class="px-4 py-4">
          <span class="badge" style="${ep.isMock ? 'background:rgba(251,191,36,.12);color:#fbbf24;border:1px solid rgba(251,191,36,.2)' : 'background:rgba(16,185,129,.12);color:#6ee7b7;border:1px solid rgba(16,185,129,.2)'}">
            ${ep.isMock ? 'Mock' : 'Published'}
          </span>
        </td>
        <td class="px-5 py-4 text-right">
          <div class="flex items-center justify-end gap-2">
            <button onclick="editEpisode(${ep.id})" class="btn btn-ghost" title="Edit"><i data-lucide="edit-3" class="w-3.5 h-3.5"></i> Edit</button>
            <button data-delete-id="${ep.id}" onclick="openDeleteModal(this)" class="btn btn-danger" title="Delete"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
          </div>
        </td>
      </tr>
    `).join('');
    lucide.createIcons();
  }

  function editEpisode(id) {
    window.location.href = `upload.html?edit=${id}`;
  }

  function openDeleteModal(btn) {
    const id = parseInt(btn.dataset.deleteId, 10);
    const ep = episodes.find(e => e.id === id);
    toDeleteId = id;
    document.getElementById('deleteModalText').textContent = ep
      ? `You are about to delete "${ep.title}". This cannot be undone.`
      : 'This action cannot be undone.';
    document.getElementById('deleteModal').classList.remove('hidden');
  }

  function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
    toDeleteId = null;
  }

  function confirmDelete() {
    if (toDeleteId) {
      episodes = episodes.filter(ep => ep.id !== toDeleteId);
      filterEpisodes();
      closeDeleteModal();
      // In production: delete from Firestore
    }
  }

  filterEpisodes();
</script>
</body>
</html>
